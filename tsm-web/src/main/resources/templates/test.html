<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSM系统测试页面</title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}">
    <style>
        body { padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #e6e6e6; border-radius: 5px; }
        .test-result { margin: 10px 0; }
        .success { color: #5FB878; }
        .error { color: #FF5722; }
    </style>
</head>
<body>
    <div class="layui-container">
        <h1>TSM系统功能测试</h1>
        
        <div class="test-section">
            <h3>页面访问测试</h3>
            <div class="layui-btn-group">
                <a href="/" class="layui-btn layui-btn-primary">首页</a>
                <a href="/login" class="layui-btn layui-btn-primary">登录页</a>
                <a href="/main" class="layui-btn layui-btn-primary">主页</a>
                <a href="/user-management" class="layui-btn layui-btn-primary">用户管理</a>
                <a href="/add-user" class="layui-btn layui-btn-primary">添加用户</a>
                <a href="/batch-import" class="layui-btn layui-btn-primary">批量导入</a>
            </div>
        </div>

        <div class="test-section">
            <h3>API接口测试</h3>
            <div class="layui-btn-group">
                <button class="layui-btn" onclick="testAPI('/api/user/list')">用户列表API</button>
                <button class="layui-btn" onclick="testAPI('/api/auth/userinfo')">用户信息API</button>
                <button class="layui-btn" onclick="testAPI('/api/test/hello')">测试API</button>
            </div>
            <div id="api-results" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>静态资源测试</h3>
            <div class="test-result">
                <p>LayUI CSS: <span id="layui-css-status">检测中...</span></p>
                <p>LayUI JS: <span id="layui-js-status">检测中...</span></p>
                <p>自定义CSS: <span id="custom-css-status">检测中...</span></p>
            </div>
        </div>

        <div class="test-section">
            <h3>控制器映射测试</h3>
            <div class="layui-btn-group">
                <button class="layui-btn" onclick="testController('/user/list')">用户视图控制器</button>
                <button class="layui-btn" onclick="testController('/auth/login')">认证视图控制器</button>
            </div>
            <div id="controller-results" class="test-result"></div>
        </div>
    </div>

    <script th:src="@{/layui/layui.js}"></script>
    <script>
        // 测试API接口
        function testAPI(url) {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML += `<p>测试 ${url}...</p>`;
            
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        resultsDiv.innerHTML += `<p class="success">✓ ${url} - 状态码: ${response.status}</p>`;
                    } else {
                        resultsDiv.innerHTML += `<p class="error">✗ ${url} - 状态码: ${response.status}</p>`;
                    }
                })
                .catch(error => {
                    resultsDiv.innerHTML += `<p class="error">✗ ${url} - 错误: ${error.message}</p>`;
                });
        }

        // 测试控制器
        function testController(url) {
            const resultsDiv = document.getElementById('controller-results');
            resultsDiv.innerHTML += `<p>测试 ${url}...</p>`;
            
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        resultsDiv.innerHTML += `<p class="success">✓ ${url} - 状态码: ${response.status}</p>`;
                    } else {
                        resultsDiv.innerHTML += `<p class="error">✗ ${url} - 状态码: ${response.status}</p>`;
                    }
                })
                .catch(error => {
                    resultsDiv.innerHTML += `<p class="error">✗ ${url} - 错误: ${error.message}</p>`;
                });
        }

        // 检测静态资源
        function checkStaticResources() {
            // 检测LayUI CSS
            const layuiCss = document.querySelector('link[href*="layui.css"]');
            document.getElementById('layui-css-status').innerHTML = layuiCss ? 
                '<span class="success">✓ 已加载</span>' : '<span class="error">✗ 未加载</span>';

            // 检测LayUI JS
            if (typeof layui !== 'undefined') {
                document.getElementById('layui-js-status').innerHTML = '<span class="success">✓ 已加载</span>';
            } else {
                document.getElementById('layui-js-status').innerHTML = '<span class="error">✗ 未加载</span>';
            }

            // 检测自定义CSS
            fetch('/css/common.css')
                .then(response => {
                    if (response.ok) {
                        document.getElementById('custom-css-status').innerHTML = '<span class="success">✓ 可访问</span>';
                    } else {
                        document.getElementById('custom-css-status').innerHTML = '<span class="error">✗ 不可访问</span>';
                    }
                })
                .catch(error => {
                    document.getElementById('custom-css-status').innerHTML = '<span class="error">✗ 错误</span>';
                });
        }

        // 页面加载完成后执行检测
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkStaticResources, 1000);
        });
    </script>
</body>
</html>