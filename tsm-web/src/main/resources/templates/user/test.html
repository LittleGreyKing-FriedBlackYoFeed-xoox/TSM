<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户列表测试</title>
    <link rel="stylesheet" href="https://unpkg.com/layui@2.8.18/dist/css/layui.css">
</head>
<body>
    <div style="padding: 20px;">
        <h2>用户列表测试页面</h2>
        <table class="layui-hide" id="userTable" lay-filter="userTable"></table>
    </div>
    
    <!-- 状态列模板 -->
    <script type="text/html" id="statusTpl">
        {{# if(d.status == 1) { }}
            <span style="color: #52c41a; font-weight: bold;">启用</span>
        {{# } else { }}
            <span style="color: #ff4d4f; font-weight: bold;">禁用</span>
        {{# } }}
    </script>
    
    <!-- 操作列模板 -->
    <script type="text/html" id="operationTpl">
        <div class="layui-btn-group">
            <button class="layui-btn layui-btn-xs" lay-event="edit">编辑</button>
            {{# if(d.status == 1) { }}
                <button class="layui-btn layui-btn-xs layui-btn-warm" lay-event="freeze">冻结</button>
            {{# } else { }}
                <button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="unfreeze">解冻</button>
            {{# } }}
            <button class="layui-btn layui-btn-xs layui-btn-danger" lay-event="delete">删除</button>
        </div>
    </script>
    
    <script src="https://unpkg.com/layui@2.8.18/dist/layui.js"></script>
    <script>
        layui.use(['table', 'layer'], function(){
            var table = layui.table;
            var layer = layui.layer;
            
            // 渲染表格
            var tableIns = table.render({
                elem: '#userTable',
                url: '/api/user/page',
                page: true,
                cols: [[
                    {field: 'id', title: 'ID', width: 80, sort: true},
                    {field: 'username', title: '用户名', width: 120},
                    {field: 'realName', title: '真实姓名', width: 120},
                    {field: 'email', title: '邮箱', width: 180},
                    {field: 'phone', title: '手机号', width: 130},
                    {field: 'status', title: '状态', width: 80, templet: '#statusTpl'},
                    {field: 'createTime', title: '创建时间', width: 160, sort: true},
                    {title: '操作', width: 200, toolbar: '#operationTpl', fixed: 'right'}
                ]],
                parseData: function(res) {
                    console.log('API Response:', res);
                    // 处理API响应格式：Result<PageResult<UserVO>>
                    if (res.code === 200 && res.data) {
                        return {
                            "code": 0, // Layui期望成功状态码为0
                            "msg": res.message || '查询成功',
                            "count": res.data.total || 0,
                            "data": res.data.records || []
                        };
                    } else {
                        return {
                            "code": res.code || 500,
                            "msg": res.message || '查询失败',
                            "count": 0,
                            "data": []
                        };
                    }
                },
                request: {
                    pageName: 'pageNum',
                    limitName: 'pageSize'
                },
                limits: [10, 20, 50],
                limit: 10
            });
            
            // 监听工具条
            table.on('tool(userTable)', function(obj){
                var data = obj.data;
                var layEvent = obj.event;
                
                if(layEvent === 'edit'){
                    layer.msg('编辑用户: ' + data.username);
                } else if(layEvent === 'freeze'){
                    layer.confirm('确定要冻结用户 "' + data.username + '" 吗？', function(index){
                        // 这里可以添加冻结逻辑
                        layer.msg('冻结成功');
                        layer.close(index);
                    });
                } else if(layEvent === 'unfreeze'){
                    layer.confirm('确定要解冻用户 "' + data.username + '" 吗？', function(index){
                        // 这里可以添加解冻逻辑
                        layer.msg('解冻成功');
                        layer.close(index);
                    });
                } else if(layEvent === 'delete'){
                    layer.confirm('确定要删除用户 "' + data.username + '" 吗？', function(index){
                        // 这里可以添加删除逻辑
                        layer.msg('删除成功');
                        layer.close(index);
                    });
                }
            });
        });
    </script>
</body>
</html>